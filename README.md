```
_/\/\/\/\/\_________________________/\/\______/\/\_______________________
_/\/\____/\/\___/\/\/\_____/\/\/\/\_/\/\/\__/\/\/\___/\/\/\___/\/\/\/\___
_/\/\/\/\/\___/\/\/\/\/\_/\/\__/\/\_/\/\/\/\/\/\/\_/\/\__/\/\_/\/\__/\/\_
_/\/\__/\/\___/\/\_________/\/\/\/\_/\/\__/\__/\/\_/\/\__/\/\_/\/\__/\/\_
_/\/\____/\/\___/\/\/\/\_______/\/\_/\/\______/\/\___/\/\/\___/\/\__/\/\_
_________________________/\/\/\/\________________________________________
```
**...provides a measurement tool set for wireless research with Atheros WiFi hardware**

### RegMon - in-Kernel MAC-Layer Monitoring
To perform the monitoring, we leverage the lightweight kernel-to-userspace debug file system (debugfs)
This serves two purposes:

1. it enables a a simple file-based configuration of RegMon for its in-kernel operations from the userspace
2. the actual trace-file from the kernel can be accessed via standard file read (e.g., with tail, cat) from the userspace.

For the actual measurements, it is possible to access Atheros control and status registers stored in the card memory through the PCI bus. Each of the Linux drivers (i.e., Madwifi, ath5k and ath9k) has its own C functions or macros to access the memory-mapped 32-bit register content, as shown at the bottom of the RegMon picture.

RegMon is implemented as a single kernel driver patch  for each of the supported three drivers, without the need for additional modules, daemons or user-space applications.
All main functions of RegMon and their interactions are:

![alt tag](https://cloud.githubusercontent.com/assets/1880886/9041313/d29e2c9e-3a07-11e5-95e3-ba5756927540.jpg)

The trace-file generated by RegMon is currently formatted as space separated list of measurement values, which turned out to be a sufficient format to parse and process the trace file for further analysis.

### How to install RegMon (under Linux OpenWrt)

1. copy RegMon patches (ath5k and/or ath9k) into openwrt/package/kernel/mac80211/patches 
2. re-build mac80211 subsystem by: make package/mac80211/{clean,compile} or re-build complite OpenWrt
3. install new mac80211 package or flash full image to your router

### How to use RegMon sampling

- specify you own register reads via: 
```
echo XY-REGISTER-VALUE > /sys/kernel//debug/ieee80211/phy0/regmon/reg7..11
```
- set the sampling interval in nanoseconds (e.g. 50000ns = 20kHz sampling rate)
```
echo 50000 > /sys/kernel//debug/ieee80211/phy0/regmon/sampling_interval
```
- read RegMon data e.g. via:
```
cat /sys/kernel/debug/ieee80211/phy0/regmon/register_log
```

For availabe Atheros registers take a look at:
```
- ath5k:
  drivers/net/wireless/ath/ath5k/reg.h
- ath9k:
  drivers/net/wireless/ath/ath9k/ath9k/ar5008_initvals.h
  drivers/net/wireless/ath/ath9k/ath9k/ar9001_initvals.h
  drivers/net/wireless/ath/ath9k/ath9k/ar9002_initvals.h
```
- collect RegMon traces, parse, analyze and plot them
(in the script folder there are several unsorted awk, shell, R & python scipts that I wrote & use .. ToDo: clean-up)

### Example of RegMon's logging output
![alt tag](https://cloud.githubusercontent.com/assets/1880886/9058435/50d96800-3aa1-11e5-98c9-330c7aa15234.jpg)

### This RegMon git repo includes:

- RegMon measurement tool provided as patches for ath5k, ath9k and madwifi Linux drivers in OpenWRT
- shell scripts to set up measurements on OpenWRT WiFi routers
- parser scripts (mainly AWK) to bring the raw RegMon data in proper shape to ananlyse with R
- R scripts to perform statistics and generate plots

### How to reference to  RegMon ?
Just use the following bibtex :
```
@PhdThesis{Huehn2013,
 author      = {Thomas H{\"u}hn},
 title       = {A Measurement-Based Joint Power and Rate Controller for IEEE 802.11 Networks},
 school      = {Technische Universit{\"a}t Berlin, FG INET Prof. Anja Feldmann},
 year        = 2013,
 month       = July,
 urn         = {urn:nbn:de:kobv:83-opus4-39397},
 url         = {http://opus4.kobv.de/opus4-tuberlin/frontdoor/index/index/docId/3939}
}
```
### Where do I get the full description of RegMon ?
[Have a look at chapter 4 of my dissertaion](https://www.researchgate.net/publication/257412979_A_measurement_based_joint_power_and_rate_controller_for_IEEE_802.11_networks)
